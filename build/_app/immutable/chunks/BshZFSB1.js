import{l as g,d as q,f as T,a as E,c as O,g as Q}from"./DYAZ3xSE.js";import{m as X,h as Y,g as Z,B as N,C as $,I as b,H as y,J as m,G as ee,D as ae,j as l,F as A,z as n,K as te}from"./CovMCToo.js";import{s as z}from"./Chg3hcGr.js";import{p as le,i as D}from"./B0vD_CDy.js";import{e as se}from"./B3QRiNGC.js";import{r as G}from"./CxkTVC9Y.js";function H(e,a,t=a){var i=X();g(e,"input",r=>{var s=r?e.defaultValue:e.value;if(s=L(e)?B(s):s,t(s),i&&s!==(s=a())){var o=e.selectionStart,f=e.selectionEnd;e.value=s??"",f!==null&&(e.selectionStart=o,e.selectionEnd=Math.min(f,e.value.length))}}),(Y&&e.defaultValue!==e.value||Z(a)==null&&e.value)&&t(L(e)?B(e.value):e.value),N(()=>{var r=a();L(e)&&r===B(e.value)||e.type==="date"&&!r&&!e.value||r!==e.value&&(e.value=r??"")})}function L(e){var a=e.type;return a==="number"||a==="range"}function B(e){return e===""?null:+e}const re="tasks",_=async e=>{var t;const a=await e.list(re);return((t=a==null?void 0:a.result)==null?void 0:t.resultRows)||[]},w="tasks",Te=async(e,a,t="")=>{const i=Date.now();return await e.insert(w,"name, description, created_at",`'${a}', '${t}', ${i}`),await _(e)},ne=async(e,a)=>(await e.remove(w,`id = ${a}`),await _(e)),xe=async e=>(await e.remove("tasks","completed = 1"),await _(e)),ie=async(e,a)=>{const t=Date.now();return await e.update(w,`completed = 1, completed_at = ${t}`,`id = ${a}`),await _(e)},We=async(e,a,t)=>(await e.update(w,`name = '${t}'`,`id = ${a}`),await _(e)),C=async(e,a,t,i)=>(await e.update(w,`name = '${t}', description = '${i}'`,`id = ${a}`),await _(e)),Ae=async(e,a)=>(await e.update(w,"completed = 0, completed_at = NULL",`id = ${a}`),await _(e));var ce=async(e,a,t)=>a(l(t).id),oe=async(e,a,t,i,r,s,o)=>{e.key==="Enter"?(a.dbWorker&&l(t).trim()&&i(await C(a.dbWorker,l(r).id,l(t).trim(),l(s).trim())),n(o,null),n(t,""),n(s,"")):e.key==="Escape"&&(n(o,null),n(t,""),n(s,""))},ue=async(e,a,t,i,r,s,o)=>{e.key==="Enter"?(a.dbWorker&&l(t).trim()&&i(await C(a.dbWorker,l(r).id,l(t).trim(),l(s).trim())),n(o,null),n(t,""),n(s,"")):e.key==="Escape"&&(n(o,null),n(t,""),n(s,""))},de=T('<div class="task-edit-container svelte-u4lnr7"><input type="text" class="task-edit-input svelte-u4lnr7" placeholder="Task name"/> <input type="text" class="task-edit-input task-description-input svelte-u4lnr7" placeholder="Task description"/></div>'),ve=T('<div class="task-content svelte-u4lnr7"><span class="task-name svelte-u4lnr7"> </span> <small class="task-description svelte-u4lnr7"> </small></div>'),me=(e,a,t,i,r)=>{n(a,l(t).id,!0),n(i,l(t).name,!0),n(r,l(t).description||"",!0)},_e=async(e,a,t,i)=>{a.dbWorker?t(await ne(a.dbWorker,l(i).id)):console.error("Worker not ready. Please wait.")},fe=T('<li class="task-item svelte-u4lnr7"><button aria-label="Finish task" class="checkbox svelte-u4lnr7"><i class="bi bi-check svelte-u4lnr7"></i></button> <!> <button class="delete-btn svelte-u4lnr7" aria-label="Edit task name"><i class="bi bi-pencil"></i></button> <button class="delete-btn svelte-u4lnr7" aria-label="Delete task"><i class="bi bi-trash"></i></button></li>'),ke=T('<div class="tasks-section svelte-u4lnr7"><h2 class="section-title svelte-u4lnr7">Todo</h2> <ul class="task-list svelte-u4lnr7"></ul></div>');function Le(e,a){$(a,!0);let t=le(a,"tasks",15),i=A(null),r=A(""),s=A(""),o=async h=>{a.dbWorker?t(await ie(a.dbWorker,h)):console.error("Worker is not ready. Please try again.")};var f=ke(),F=b(y(f),2);se(F,21,t,h=>h.id,(h,c)=>{var P=O(),I=ae(P);{var J=x=>{var W=fe(),S=y(W);S.__click=[ce,o,c];var V=b(S,2);{var K=k=>{var d=de(),v=y(d);G(v),v.__keydown=[oe,a,r,t,c,s,i];var p=b(v,2);G(p),p.__keydown=[ue,a,r,t,c,s,i],m(d),Q("blur",d,async u=>{u.currentTarget.contains(u.relatedTarget)||(a.dbWorker&&l(r).trim()&&(l(r)!==l(c).name||l(s)!==l(c).description)&&t(await C(a.dbWorker,l(c).id,l(r).trim(),l(s).trim())),n(i,null),n(r,""),n(s,""))}),H(v,()=>l(r),u=>n(r,u)),H(p,()=>l(s),u=>n(s,u)),E(k,d)},M=k=>{var d=ve(),v=y(d),p=y(v,!0);m(v);var u=b(v,2),U=y(u,!0);m(u),m(d),te(()=>{z(p,l(c).name),z(U,l(c).description)}),E(k,d)};D(V,k=>{l(i)===l(c).id?k(K):k(M,!1)})}var j=b(V,2);j.__click=[me,i,c,r,s];var R=b(j,2);R.__click=[_e,a,t,c],m(W),E(x,W)};D(I,x=>{l(c).completed||x(J)})}E(h,P)}),m(F),m(f),E(e,f),ee()}q(["click","keydown"]);export{Le as T,Te as a,H as b,ne as c,xe as d,We as e,_ as l,Ae as m,C as u};
