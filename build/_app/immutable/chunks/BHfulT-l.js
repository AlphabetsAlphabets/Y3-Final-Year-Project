import{l as R,d as U,f as h,a as f,c as q,g as J}from"./C2cYCDAH.js";import{m as K,h as N,g as O,aj as Q,A as X,G as y,F as b,H as w,D as Y,B as Z,j as s,C,I as j,z as c}from"./BZCZPUy_.js";import{s as F}from"./BTy8cjxq.js";import{p as $,i as I}from"./3Dlza38i.js";import{e as aa}from"./TFHsxczQ.js";import{r as ea}from"./CC_dDezr.js";function ta(a,e,t=e){var r=K();R(a,"input",l=>{var i=l?a.defaultValue:a.value;if(i=g(a)?A(i):i,t(i),r&&i!==(i=e())){var u=a.selectionStart,m=a.selectionEnd;a.value=i??"",m!==null&&(a.selectionStart=u,a.selectionEnd=Math.min(m,a.value.length))}}),(N&&a.defaultValue!==a.value||O(e)==null&&a.value)&&t(g(a)?A(a.value):a.value),Q(()=>{var l=e();g(a)&&l===A(a.value)||a.type==="date"&&!l&&!a.value||l!==a.value&&(a.value=l??"")})}function g(a){var e=a.type;return e==="number"||e==="range"}function A(a){return a===""?null:+a}const sa="tasks",d=async a=>{var t;const e=await a.list(sa);return((t=e==null?void 0:e.result)==null?void 0:t.resultRows)||[]},k="tasks",ha=async(a,e,t="")=>{const r=Date.now();return await a.insert(k,"name, description, created_at",`'${e}', '${t}', ${r}`),await d(a)},la=async(a,e)=>(await a.remove(k,`id = ${e}`),await d(a)),xa=async a=>(await a.remove("tasks","completed = 1"),await d(a)),ra=async(a,e)=>{const t=Date.now();return await a.update(k,`completed = 1, completed_at = ${t}`,`id = ${e}`),await d(a)},P=async(a,e,t)=>(await a.update(k,`name = '${t}'`,`id = ${e}`),await d(a)),Ta=async(a,e)=>(await a.update(k,"completed = 0, completed_at = NULL",`id = ${e}`),await d(a));var ia=async(a,e,t)=>e(s(t).id),na=async(a,e,t,r,l,i)=>{a.key==="Enter"?(e.dbWorker&&s(t).trim()&&r(await P(e.dbWorker,s(l).id,s(t).trim())),c(i,null),c(t,"")):a.key==="Escape"&&(c(i,null),c(t,""))},oa=h('<input type="text" class="task-edit-input svelte-1wx5yv9"/>'),ca=h('<span class="task-name svelte-1wx5yv9"> </span>'),va=(a,e,t,r)=>{c(e,s(t).id,!0),c(r,s(t).name,!0)},da=async(a,e,t,r)=>{e.dbWorker?t(await la(e.dbWorker,s(r).id)):console.error("Worker not ready. Please wait.")},ua=h('<li class="task-item svelte-1wx5yv9"><button aria-label="Finish task" class="checkbox svelte-1wx5yv9"><i class="bi bi-check svelte-1wx5yv9"></i></button> <!> <small> </small> <button class="delete-btn svelte-1wx5yv9" aria-label="Edit task name"><i class="bi bi-pencil"></i></button> <button class="delete-btn svelte-1wx5yv9" aria-label="Delete task"><i class="bi bi-trash"></i></button></li>'),ma=h('<div class="tasks-section svelte-1wx5yv9"><h2 class="section-title svelte-1wx5yv9">Todo</h2> <ul class="task-list svelte-1wx5yv9"></ul></div>');function pa(a,e){X(e,!0);let t=$(e,"tasks",15),r=C(null),l=C(""),i=async _=>{e.dbWorker?t(await ra(e.dbWorker,_)):console.error("Worker is not ready. Please try again.")};var u=ma(),m=y(b(u),2);aa(m,21,t,_=>_.id,(_,n)=>{var D=q(),S=Z(D);{var V=x=>{var T=ua(),L=b(T);L.__click=[ia,i,n];var W=y(L,2);{var z=v=>{var o=oa();ea(o),o.__keydown=[na,e,l,t,n,r],J("blur",o,async()=>{e.dbWorker&&s(l).trim()&&s(l)!==s(n).name&&t(await P(e.dbWorker,s(n).id,s(l).trim())),c(r,null),c(l,"")}),ta(o,()=>s(l),E=>c(l,E)),f(v,o)},G=v=>{var o=ca(),E=b(o,!0);w(o),j(()=>F(E,s(n).name)),f(v,o)};I(W,v=>{s(r)===s(n).id?v(z):v(G,!1)})}var p=y(W,2),H=b(p,!0);w(p);var B=y(p,2);B.__click=[va,r,n,l];var M=y(B,2);M.__click=[da,e,t,n],w(T),j(()=>F(H,s(n).description)),f(x,T)};I(S,x=>{s(n).completed||x(V)})}f(_,D)}),w(m),w(u),f(a,u),Y()}U(["click","keydown"]);export{pa as T,ha as a,ta as b,la as c,xa as d,d as l,Ta as m,P as u};
