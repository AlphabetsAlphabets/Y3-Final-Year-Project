import{l as J,d as K,f as T,a as p,c as O,g as Q}from"./C2cYCDAH.js";import{m as X,h as Y,g as Z,aj as N,A as $,G as k,F as b,H as m,D as ee,B as ae,j as l,C as A,z as n,I as te}from"./BZCZPUy_.js";import{s as z}from"./BTy8cjxq.js";import{p as le,i as D}from"./3Dlza38i.js";import{e as se}from"./TFHsxczQ.js";import{r as G}from"./CC_dDezr.js";function H(e,a,t=a){var i=X();J(e,"input",r=>{var s=r?e.defaultValue:e.value;if(s=L(e)?B(s):s,t(s),i&&s!==(s=a())){var o=e.selectionStart,_=e.selectionEnd;e.value=s??"",_!==null&&(e.selectionStart=o,e.selectionEnd=Math.min(_,e.value.length))}}),(Y&&e.defaultValue!==e.value||Z(a)==null&&e.value)&&t(L(e)?B(e.value):e.value),N(()=>{var r=a();L(e)&&r===B(e.value)||e.type==="date"&&!r&&!e.value||r!==e.value&&(e.value=r??"")})}function L(e){var a=e.type;return a==="number"||a==="range"}function B(e){return e===""?null:+e}const re="tasks",y=async e=>{var t;const a=await e.list(re);return((t=a==null?void 0:a.result)==null?void 0:t.resultRows)||[]},E="tasks",Te=async(e,a,t="")=>{const i=Date.now();return await e.insert(E,"name, description, created_at",`'${a}', '${t}', ${i}`),await y(e)},ne=async(e,a)=>(await e.remove(E,`id = ${a}`),await y(e)),xe=async e=>(await e.remove("tasks","completed = 1"),await y(e)),ie=async(e,a)=>{const t=Date.now();return await e.update(E,`completed = 1, completed_at = ${t}`,`id = ${a}`),await y(e)},C=async(e,a,t,i)=>(await e.update(E,`name = '${t}', description = '${i}'`,`id = ${a}`),await y(e)),We=async(e,a)=>(await e.update(E,"completed = 0, completed_at = NULL",`id = ${a}`),await y(e));var ce=async(e,a,t)=>a(l(t).id),oe=async(e,a,t,i,r,s,o)=>{e.key==="Enter"?(a.dbWorker&&l(t).trim()&&i(await C(a.dbWorker,l(r).id,l(t).trim(),l(s).trim())),n(o,null),n(t,""),n(s,"")):e.key==="Escape"&&(n(o,null),n(t,""),n(s,""))},ue=async(e,a,t,i,r,s,o)=>{e.key==="Enter"?(a.dbWorker&&l(t).trim()&&i(await C(a.dbWorker,l(r).id,l(t).trim(),l(s).trim())),n(o,null),n(t,""),n(s,"")):e.key==="Escape"&&(n(o,null),n(t,""),n(s,""))},ve=T('<div class="task-edit-container svelte-u4lnr7"><input type="text" class="task-edit-input svelte-u4lnr7" placeholder="Task name"/> <input type="text" class="task-edit-input task-description-input svelte-u4lnr7" placeholder="Task description"/></div>'),de=T('<div class="task-content svelte-u4lnr7"><span class="task-name svelte-u4lnr7"> </span> <small class="task-description svelte-u4lnr7"> </small></div>'),me=(e,a,t,i,r)=>{n(a,l(t).id,!0),n(i,l(t).name,!0),n(r,l(t).description||"",!0)},_e=async(e,a,t,i)=>{a.dbWorker?t(await ne(a.dbWorker,l(i).id)):console.error("Worker not ready. Please wait.")},fe=T('<li class="task-item svelte-u4lnr7"><button aria-label="Finish task" class="checkbox svelte-u4lnr7"><i class="bi bi-check svelte-u4lnr7"></i></button> <!> <button class="delete-btn svelte-u4lnr7" aria-label="Edit task name"><i class="bi bi-pencil"></i></button> <button class="delete-btn svelte-u4lnr7" aria-label="Delete task"><i class="bi bi-trash"></i></button></li>'),ke=T('<div class="tasks-section svelte-u4lnr7"><h2 class="section-title svelte-u4lnr7">Todo</h2> <ul class="task-list svelte-u4lnr7"></ul></div>');function Ae(e,a){$(a,!0);let t=le(a,"tasks",15),i=A(null),r=A(""),s=A(""),o=async w=>{a.dbWorker?t(await ie(a.dbWorker,w)):console.error("Worker is not ready. Please try again.")};var _=ke(),j=k(b(_),2);se(j,21,t,w=>w.id,(w,c)=>{var F=O(),I=ae(F);{var M=x=>{var W=fe(),P=b(W);P.__click=[ce,o,c];var S=k(P,2);{var R=f=>{var v=ve(),d=b(v);G(d),d.__keydown=[oe,a,r,t,c,s,i];var h=k(d,2);G(h),h.__keydown=[ue,a,r,t,c,s,i],m(v),Q("blur",v,async u=>{u.currentTarget.contains(u.relatedTarget)||(a.dbWorker&&l(r).trim()&&(l(r)!==l(c).name||l(s)!==l(c).description)&&t(await C(a.dbWorker,l(c).id,l(r).trim(),l(s).trim())),n(i,null),n(r,""),n(s,""))}),H(d,()=>l(r),u=>n(r,u)),H(h,()=>l(s),u=>n(s,u)),p(f,v)},U=f=>{var v=de(),d=b(v),h=b(d,!0);m(d);var u=k(d,2),q=b(u,!0);m(u),m(v),te(()=>{z(h,l(c).name),z(q,l(c).description)}),p(f,v)};D(S,f=>{l(i)===l(c).id?f(R):f(U,!1)})}var V=k(S,2);V.__click=[me,i,c,r,s];var g=k(V,2);g.__click=[_e,a,t,c],m(W),p(x,W)};D(I,x=>{l(c).completed||x(M)})}p(w,F)}),m(j),m(_),p(e,_),ee()}K(["click","keydown"]);export{Ae as T,Te as a,H as b,ne as c,xe as d,y as l,We as m,C as u};
