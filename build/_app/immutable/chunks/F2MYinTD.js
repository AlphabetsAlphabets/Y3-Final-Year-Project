const d=async t=>{var o;const s=await t.list("project");return((o=s==null?void 0:s.result)==null?void 0:o.resultRows)||[]},m=async(t,s,o)=>(await(t==null?void 0:t.insert("project","name, color",`'${s}', '${o}'`)),await d(t)),h=async t=>{var o;const s=await t.list("activity");return console.log("Received activities from worker.",s),((o=s==null?void 0:s.result)==null?void 0:o.resultRows)||[]},j=async(t,s)=>(await t.insert("activity","name",`'${s}'`),await h(t));function v(t){const s=t.getFullYear(),o=(t.getMonth()+1).toString().padStart(2,"0"),n=t.getDate().toString().padStart(2,"0"),a=t.getHours().toString().padStart(2,"0"),e=t.getMinutes().toString().padStart(2,"0");return`${s}-${o}-${n}T${a}:${e}`}async function y(t,s){return t.length>0&&t!==s.title?[`activity = '${t}'`]:[]}async function $(t,s){return t.length!==0&&t!==s.backgroundColor?[`color = '${t}'`,`color = '${s.backgroundColor}'`]:[]}async function u(t,s){const o=[],n=t.getTime()-s.getTime();return t.getTime()>=s.getTime()?(console.error("Start time must be before end time."),o):(o.push(`start = ${t.getTime()}`),o.push(`end = ${s.getTime()}`),o.push(`elapsed = ${n}`),o)}const f=async t=>{const s=await t.list("log");console.log("Received logs from worker",s),s&&s.result&&s.result.resultRows||console.error("Something went wrong.");const o=s.result.resultRows;return Promise.all(o.map(async a=>{const e=await t.list("project","color",`name = '${a.project_name}'`);return a.project_color=e.result.resultRows[0].color,a}))||[]},R=async(t,s,o,n,a,e)=>(await t.insert("log","activity, project_name, elapsed, start, end",`'${s}', '${o}', ${n}, ${a}, ${e}`),await f(t)),w=async(t,s,o)=>{await t.update("log",s,o)},S=async(t,s,o,n,a,e,i,g)=>{const c=[],p=await y(o,a);if(c.push(...p),e&&i){const r=await u(e,i);c.push(...r)}else if(e){const r=await u(e,a.end);c.push(...r)}else if(i){const r=await u(a.start,i);c.push(...r)}else console.error("Something went wrong.");const l=await $(n,a);if(l.length!==0&&s.update("project",l[0],l[1]),c.length===0){t.closeModal(),l.length!==0&&g();return}await w(s,c.join(", "),`id = ${a.id}`),g(),t.closeModal()};export{m as a,j as b,R as c,d,w as e,v as f,f as g,S as h,h as l,u};
