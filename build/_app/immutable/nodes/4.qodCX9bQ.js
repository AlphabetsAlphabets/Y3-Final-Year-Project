import{p as U,b as ct,i as V,_ as vt}from"../chunks/3Dlza38i.js";import{d as at,f as b,a as p,c as kt,g as wt}from"../chunks/C2cYCDAH.js";import{A as J,B,C as R,F as c,H as s,G as k,j as t,z as d,aC as rt,I as G,D as Q,am as K,aA as ut,f as ht,aS as xt}from"../chunks/BZCZPUy_.js";import{s as O}from"../chunks/BTy8cjxq.js";import{e as $}from"../chunks/TFHsxczQ.js";import{s as jt,a as At}from"../chunks/DeFZ_gIw.js";import{w as dt}from"../chunks/B8fJUUNV.js";import{r as Y,b as Wt}from"../chunks/CC_dDezr.js";import{b as Z,l as Pt,T as St}from"../chunks/CBK41Jc8.js";import{M as _t}from"../chunks/D9K11hyb.js";import{u as Mt,a as Nt,l as Tt}from"../chunks/Cn_idqSd.js";import{T as F,s as Ct,a as Lt,b as Rt,r as Dt,p as qt,c as mt,l as lt,d as Et}from"../chunks/Bg3a6fG9.js";var Ot=(l,e,a)=>{var r;d(e,""),(r=t(a))==null||r.showModal()},It=(l,e,a,r,_,o,n)=>{var S;d(e,t(a).name,!0),r(t(e)),d(_,t(a).color,!0),o(t(_)),(S=t(n))==null||S.closeModal()},Ht=async(l,e,a,r)=>{e(await Mt(a.dbWorker,t(r).name,t(r).color))},Vt=b('<li class="option-item svelte-odkst2"><div class="d-flex"><button type="button" class="btn btn-outline-primary w-100 d-flex p-0 svelte-odkst2"><span class="project-name svelte-odkst2"> </span></button> <input type="color" class="form-control form-control-color svelte-odkst2" title="Update project color"/></div></li>'),zt=b('<ul class="options-list svelte-odkst2"></ul>'),Bt=async(l,e,a,r,_,o,n,S)=>{var m;if(!e.dbWorker){console.error("dbWorker not ready yet.");return}a(await Nt(e.dbWorker,t(r),t(_))),o(t(r)),n(t(_)),(m=t(S))==null||m.closeModal()},Ft=b('<p> </p> <div class="new-project-section svelte-odkst2"><div class="color-picker-container svelte-odkst2"><input type="color" id="project-color" title="Choose project color" class="svelte-odkst2"/></div> <button type="button" class="btn btn-outline-success w-100 mt-2"> </button></div>',1),Gt=b('<input type="text" class="form-control mb-3" placeholder="Type name of project. Relaxing, work, etc."/> <!> <button type="button" class="btn btn-secondary w-100 mt-3">Cancel</button>',1),Kt=b('<button id="activity select" type="button" class="btn btn-outline-primary w-100"> </button> <!>',1);function Ut(l,e){J(e,!0);let a=U(e,"selected",15),r=U(e,"color",15),_=U(e,"projects",15),o=R(null),n=R(""),S=R("#3498db"),m=rt(()=>t(n).length===0?_():_().filter(M=>M.name.toLowerCase().includes(t(n).toLowerCase())));var I=Kt(),i=B(I);i.__click=[Ot,n,o];var v=c(i,!0);s(i);var E=k(i,2);ct(_t(E,{title:"Select a project",children:(M,N)=>{var T=Gt(),x=B(T);Y(x);var D=k(x,2);{var H=y=>{var A=zt();$(A,21,()=>t(m),w=>w.name,(w,f,h)=>{var W=Vt(),P=c(W),u=c(P);u.__click=[It,n,f,a,S,r,o];var C=c(u),L=c(C,!0);s(C),s(u);var z=k(u,2);Y(z),z.__change=[Ht,_,e,f],s(P),s(W),G(()=>O(L,t(f).name)),Z(z,()=>t(f).color,tt=>t(f).color=tt),p(w,W)}),s(A),p(y,A)},j=y=>{var A=Ft(),w=B(A),f=c(w);s(w);var h=k(w,2),W=c(h),P=c(W);Y(P),s(W);var u=k(W,2);u.__click=[Bt,e,_,n,S,a,r,o];var C=c(u);s(u),s(h),G(()=>{O(f,`No options found for "${t(n)??""}"`),O(C,`Create "${t(n)??""}"`)}),Z(P,()=>t(S),L=>d(S,L)),p(y,A)};V(D,y=>{t(m).length>0||t(n)===""?y(H):y(j,!1)})}var q=k(D,2);q.__click=function(...y){var A,w;(w=(A=t(o))==null?void 0:A.closeModal)==null||w.apply(this,y)},Z(x,()=>t(n),y=>d(n,y)),p(M,T)},$$slots:{default:!0}}),M=>d(o,M,!0),()=>t(o)),G(()=>O(v,t(n)||"No Project")),p(l,I),Q()}at(["click","change"]);const ot=async l=>{var a;const e=await l.list("activity");return console.log("Received activities from worker.",e),((a=e==null?void 0:e.result)==null?void 0:a.resultRows)||[]},Jt=async(l,e)=>(await l.insert("activity","name",`'${e}'`),await ot(l)),Qt=async(l,e)=>(await l.remove("activity",`id = ${e}`),await ot(l));var Xt=(l,e,a)=>{var r;d(e,""),(r=t(a))==null||r.showModal()},Yt=(l,e,a,r,_)=>{var o;e(t(a).name),d(r,""),(o=t(_))==null||o.closeModal()},Zt=b('<span class="badge bg-success">TASK</span>'),$t=async(l,e,a,r)=>{if(l.stopPropagation(),!e.dbWorker){console.error("dbWorker not ready yet.");return}a(await Qt(e.dbWorker,t(r).id))},te=b('<li class="option-item svelte-1llkq39"><div class="option-container svelte-1llkq39"><button type="button" class="btn btn-outline-primary option-select-btn svelte-1llkq39"><!> </button> <button type="button" class="delete-btn svelte-1llkq39" aria-label="Delete activity"><i class="bi bi-trash"></i></button></div></li>'),ee=b('<ul class="options-list svelte-1llkq39"></ul>'),ae=async(l,e,a,r,_,o)=>{var n;if(!e.dbWorker){console.error("dbWorker not ready yet.");return}a(await Jt(e.dbWorker,t(r))),_(t(r)),d(r,""),(n=t(o))==null||n.closeModal()},re=b('<p> </p> <button type="button" class="btn btn-outline-success w-100"> </button>',1),oe=(l,e,a)=>{var r;d(e,""),(r=t(a))==null||r.closeModal()},se=b('<input type="text" class="form-control mb-3" placeholder="Name of an activity. Reading, writing, etc."/> <!> <button type="button" class="btn btn-secondary w-100 mt-3">Cancel</button>',1),ne=b('<button id="activity select" type="button" class="btn btn-outline-primary w-100"> </button> <!>',1);function ie(l,e){J(e,!0);let a=U(e,"selected",15),r=U(e,"taskAndActivities",15),_=R(null),o=R(""),n=rt(()=>t(o).length===0?r():r().filter(v=>v.name.toLowerCase().includes(t(o).toLowerCase())));var S=ne(),m=B(S);m.__click=[Xt,o,_];var I=c(m,!0);s(m);var i=k(m,2);ct(_t(i,{title:"Select an activity",children:(v,E)=>{var M=se(),N=B(M);Y(N);var T=k(N,2);{var x=j=>{var q=ee();$(q,21,()=>t(n),y=>y.name,(y,A)=>{var w=te(),f=c(w),h=c(f);h.__click=[Yt,a,A,o,_];var W=c(h);{var P=L=>{var z=Zt();p(L,z)};V(W,L=>{t(A).isTask&&L(P)})}var u=k(W);s(h);var C=k(h,2);C.__click=[$t,e,r,A],s(f),s(w),G(()=>O(u,` ${t(A).name??""}`)),p(y,w)}),s(q),p(j,q)},D=j=>{var q=re(),y=B(q),A=c(y);s(y);var w=k(y,2);w.__click=[ae,e,r,o,a,_];var f=c(w);s(w),G(()=>{O(A,`No options found for "${t(o)??""}"`),O(f,`Create "${t(o)??""}"`)}),p(j,q)};V(T,j=>{t(n).length>0||t(o)===""?j(x):j(D,!1)})}var H=k(T,2);H.__click=[oe,o,_],Z(N,()=>t(o),j=>d(o,j)),p(v,M)},$$slots:{default:!0}}),v=>d(_,v,!0),()=>t(_)),G(()=>O(I,a())),p(l,S),Q()}at(["click"]);var le=(l,e)=>{Ct(),d(e,F.Running,!0)},ce=b('<button type="button" class="btn btn-outline-success w-100 h-100 d-flex justify-content-center align-items-center">Start</button>'),ve=(l,e)=>{Dt(),d(e,F.Running,!0)},ue=b('<button type="button" class="btn btn-outline-primary flex-grow-1" style="margin-right: 10px;">Resume</button>'),de=(l,e)=>{qt(),d(e,F.Paused,!0)},_e=b('<button type="button" class="btn btn-outline-warning flex-grow-1" style="margin-right: 10px;">Pause</button>'),me=async(l,e,a,r)=>{if(e.activityName.length===0||e.activityName==="Activity"){console.log(e.activityName),console.error("No activity selected.");return}let[_,o,n]=Lt();if(!t(a)){console.error("No database worker available.");return}await Rt(t(a),e.activityName,e.projectName,n,_,o),d(r,F.Stopped,!0),e.onActivityStopped&&await e.onActivityStopped()},pe=b('<div style="display: flex; justify-content: space-between; margin-top: 10px;"><!> <button type="button" class="btn btn-outline-danger flex-grow-1">Stop</button></div>'),fe=b("<!> <!>",1);function be(l,e){J(e,!0);let a=R(K(F.Stopped)),r=R(null);ut(async()=>{const i=await vt(()=>import("../chunks/BYbjoqHL.js"),[],import.meta.url);d(r,dt(new i.default),!0),await t(r).initWorker()});var o=fe(),n=B(o);{var S=i=>{var v=ce();v.__click=[le,a],p(i,v)};V(n,i=>{t(a)===F.Stopped&&i(S)})}var m=k(n,2);{var I=i=>{var v=pe(),E=c(v);{var M=x=>{var D=ue();D.__click=[ve,a],p(x,D)},N=x=>{var D=_e();D.__click=[de,a],p(x,D)};V(E,x=>{t(a)===F.Paused?x(M):x(N,!1)})}var T=k(E,2);T.__click=[me,e,r,a],s(v),p(i,v)};V(m,i=>{(t(a)===F.Running||t(a)===F.Paused)&&i(I)})}p(l,o),Q()}at(["click"]);var ye=b('<span class="badge rounded-pill"> </span>'),ge=b('<li class="svelte-fg8y06"><strong> </strong> <!> <span class="duration svelte-fg8y06"> </span> <span class="ended svelte-fg8y06"> </span></li>'),ke=b('<div class="scrollable-list svelte-fg8y06"><ul class="svelte-fg8y06"></ul></div>'),we=b("<p>No recently tracked activities found.</p>"),he=b("<p>Loading recently tracked activities...</p>"),xe=b('<div class="recently-done-container svelte-fg8y06"><h3>Recent activities</h3> <!></div>');function je(l,e){J(e,!0);let a=R(K([]));const r=async()=>{d(a,e.logs.sort((i,v)=>v.end-i.end).slice(0,10),!0)},_=i=>{const v=new Date(i);return v.toLocaleDateString()+" "+v.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})},o=i=>{let{hours:v,minutes:E,seconds:M}=mt(i);const N=[];return v>0&&N.push(`${Math.round(v)}h`),E>0&&N.push(`${Math.round(E)}m`),(M>0||N.length===0)&&N.push(`${Math.round(M)}s`),N.join("")};ht(()=>{r()});var n=xe(),S=k(c(n),2);{var m=i=>{var v=kt(),E=B(v);{var M=T=>{var x=ke(),D=c(x);$(D,21,()=>t(a),H=>H.id,(H,j)=>{var q=ge(),y=c(q),A=c(y,!0);s(y);var w=k(y,2);{var f=C=>{var L=ye(),z=c(L,!0);s(L),G(()=>{Wt(L,`background-color: ${t(j).project_color||"#6c757d"}; color: white; margin-left: 8px;`),O(z,t(j).project_name)}),p(C,L)};V(w,C=>{t(j).project_name&&C(f)})}var h=k(w,2),W=c(h,!0);s(h);var P=k(h,2),u=c(P,!0);s(P),s(q),G((C,L)=>{O(A,t(j).activity),O(W,C),O(u,L)},[()=>o(t(j).elapsed),()=>_(t(j).end)]),p(H,q)}),s(D),s(x),p(T,x)},N=T=>{var x=we();p(T,x)};V(E,T=>{t(a).length>0?T(M):T(N,!1)})}p(i,v)},I=i=>{var v=he();p(i,v)};V(S,i=>{e.dbWorker?i(m):i(I,!1)})}s(n),p(l,n),Q()}var Ae=b(" <sup> </sup>",1),We=b("<p>Please select or create an activity to track.</p>"),Pe=b('<!> <br/> <form><div class="d-flex gap-2 mb-3"><div class="flex-grow-1"><!></div> <div class="flex-grow-1"><!></div></div> <div class="display-1 fw-bold my-3"></div> <!></form> <br/> <!>',1),Se=b('<div class="d-flex flex-column align-items-center p-5"><div class="spinner-border text-primary" role="status"><span class="visually-hidden">Loading...</span></div> <p class="mt-3 mb-0">Please wait while the app loads</p></div>'),Me=b('<main class="container mt-5"><div class="row justify-content-center"><div class="col-md-8 col-lg-6 text-center"><!></div></div></main>');function ze(l,e){J(e,!0);const[a,r]=jt(),_=()=>At(Et,"$seconds",a);let o=R("Activity"),n=R("No Project"),S=R(""),m=R(null),I=R(K([])),i=R(K([])),v=R(K([])),E=R(K([]));const M=(f,h)=>{const W=f.filter(u=>u.completed==0).map(u=>({id:u.id,name:u.name,isTask:!0})),P=h.map(u=>({id:u.id,name:u.name,isTask:!1}));return[...W,...P]};let N=rt(()=>M(t(I),t(v)));const T=f=>{let{hours:h,minutes:W,seconds:P}=mt(f);const u=[];return h>0&&u.push({value:h,unit:"h"}),W>0&&u.push({value:W,unit:"m"}),(P>0||u.length===0)&&u.push({value:P,unit:"s"}),u},x=async()=>{const f=await vt(()=>import("../chunks/BYbjoqHL.js"),[],import.meta.url);d(m,dt(new f.default),!0),await t(m).initWorker(),d(I,await Pt(t(m)),!0),d(v,await ot(t(m)),!0),d(E,await Tt(t(m)),!0),d(i,await lt(t(m)),!0)},D=async()=>{t(m)&&d(i,await lt(t(m)),!0)};ut(x);var H=Me(),j=c(H),q=c(j),y=c(q);{var A=f=>{var h=Pe(),W=B(h);St(W,{get dbWorker(){return t(m)},get tasks(){return t(I)},set tasks(g){d(I,g,!0)}});var P=k(W,4),u=c(P),C=c(u),L=c(C);ie(L,{get dbWorker(){return t(m)},get selected(){return t(o)},set selected(g){d(o,g,!0)},get taskAndActivities(){return t(N)},set taskAndActivities(g){d(N,g,!0)}}),s(C);var z=k(C,2),tt=c(z);Ut(tt,{get dbWorker(){return t(m)},get selected(){return t(n)},set selected(g){d(n,g,!0)},get color(){return t(S)},set color(g){d(S,g,!0)},get projects(){return t(E)},set projects(g){d(E,g,!0)}}),s(z),s(u);var et=k(u,2);$(et,5,()=>T(_()),g=>g.unit,(g,X)=>{xt();var st=Ae(),nt=B(st,!0),it=k(nt),gt=c(it,!0);s(it),G(()=>{O(nt,t(X).value),O(gt,t(X).unit)}),p(g,st)}),s(et);var pt=k(et,2);{var ft=g=>{var X=We();p(g,X)},bt=g=>{be(g,{get activityName(){return t(o)},get projectName(){return t(n)},onActivityStopped:D})};V(pt,g=>{t(o)==="Activity"?g(ft):g(bt,!1)})}s(P);var yt=k(P,4);je(yt,{get dbWorker(){return t(m)},get logs(){return t(i)}}),wt("submit",P,g=>g.preventDefault()),p(f,h)},w=f=>{var h=Se();p(f,h)};V(y,f=>{t(m)?f(A):f(w,!1)})}s(q),s(j),s(H),p(l,H),Q(),r()}export{ze as component};
