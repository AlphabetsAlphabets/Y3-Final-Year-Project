import{p as K,b as vt,i as H,_ as ut}from"../chunks/3Dlza38i.js";import{d as $,f,a as p,c as xt,g as jt}from"../chunks/C2cYCDAH.js";import{A as U,B as z,C as R,F as c,H as n,G as y,j as t,z as _,aC as ot,I as F,D as J,am as G,aA as dt,f as At,aS as Tt}from"../chunks/BZCZPUy_.js";import{s as q}from"../chunks/BTy8cjxq.js";import{e as tt}from"../chunks/TFHsxczQ.js";import{s as St,a as Wt}from"../chunks/DeFZ_gIw.js";import{w as _t}from"../chunks/B8fJUUNV.js";import{r as X,b as Pt}from"../chunks/CC_dDezr.js";import{b as Z,l as Ct,T as Nt}from"../chunks/BHfulT-l.js";import{M as mt}from"../chunks/D9K11hyb.js";import{u as Mt,a as Dt,l as Lt}from"../chunks/Cn_idqSd.js";import{T as B,s as Rt,a as It,b as pt,r as Et,p as qt,c as bt,l as ct,d as Ot}from"../chunks/Bg3a6fG9.js";var Vt=(l,e,a)=>{var r;_(e,""),(r=t(a))==null||r.showModal()},Ht=(l,e,a,r,v,o,s)=>{var W;_(e,t(a).name,!0),r(t(e)),_(v,t(a).color,!0),o(t(v)),(W=t(s))==null||W.closeModal()},Yt=async(l,e,a,r)=>{e(await Mt(a.dbWorker,t(r).name,t(r).color))},zt=f('<li class="option-item svelte-odkst2"><div class="d-flex"><button type="button" class="btn btn-outline-primary w-100 d-flex p-0 svelte-odkst2"><span class="project-name svelte-odkst2"> </span></button> <input type="color" class="form-control form-control-color svelte-odkst2" title="Update project color"/></div></li>'),Bt=f('<ul class="options-list svelte-odkst2"></ul>'),Ft=async(l,e,a,r,v,o,s,W)=>{var m;if(!e.dbWorker){console.error("dbWorker not ready yet.");return}a(await Dt(e.dbWorker,t(r),t(v))),o(t(r)),s(t(v)),(m=t(W))==null||m.closeModal()},Gt=f('<p> </p> <div class="new-project-section svelte-odkst2"><div class="color-picker-container svelte-odkst2"><input type="color" id="project-color" title="Choose project color" class="svelte-odkst2"/></div> <button type="button" class="btn btn-outline-success w-100 mt-2"> </button></div>',1),Kt=f('<input type="text" class="form-control mb-3" placeholder="Type name of project. Relaxing, work, etc."/> <!> <button type="button" class="btn btn-secondary w-100 mt-3">Cancel</button>',1),Ut=f('<button id="activity select" type="button" class="btn btn-outline-primary w-100"> </button> <!>',1);function Jt(l,e){U(e,!0);let a=K(e,"selected",15),r=K(e,"color",15),v=K(e,"projects",15),o=R(null),s=R(""),W=R("#3498db"),m=ot(()=>t(s).length===0?v():v().filter(P=>P.name.toLowerCase().includes(t(s).toLowerCase())));var O=Ut(),i=z(O);i.__click=[Vt,s,o];var u=c(i,!0);n(i);var E=y(i,2);vt(mt(E,{title:"Select a project",children:(P,C)=>{var N=Kt(),x=z(N);X(x);var M=y(x,2);{var V=g=>{var A=Bt();tt(A,21,()=>t(m),w=>w.name,(w,b,h)=>{var T=zt(),S=c(T),d=c(S);d.__click=[Ht,s,b,a,W,r,o];var D=c(d),L=c(D,!0);n(D),n(d);var Y=y(d,2);X(Y),Y.__change=[Yt,v,e,b],n(S),n(T),F(()=>q(L,t(b).name)),Z(Y,()=>t(b).color,et=>t(b).color=et),p(w,T)}),n(A),p(g,A)},j=g=>{var A=Gt(),w=z(A),b=c(w);n(w);var h=y(w,2),T=c(h),S=c(T);X(S),n(T);var d=y(T,2);d.__click=[Ft,e,v,s,W,a,r,o];var D=c(d);n(d),n(h),F(()=>{q(b,`No options found for "${t(s)??""}"`),q(D,`Create "${t(s)??""}"`)}),Z(S,()=>t(W),L=>_(W,L)),p(g,A)};H(M,g=>{t(m).length>0||t(s)===""?g(V):g(j,!1)})}var I=y(M,2);I.__click=function(...g){var A,w;(w=(A=t(o))==null?void 0:A.closeModal)==null||w.apply(this,g)},Z(x,()=>t(s),g=>_(s,g)),p(P,N)},$$slots:{default:!0}}),P=>_(o,P,!0),()=>t(o)),F(()=>q(u,t(s)||"No Project")),p(l,O),J()}$(["click","change"]);const st=async l=>{var a;const e=await l.list("activity");return console.log("Received activities from worker.",e),((a=e==null?void 0:e.result)==null?void 0:a.resultRows)||[]},Qt=async(l,e)=>(await l.insert("activity","name",`'${e}'`),await st(l)),Xt=async(l,e)=>(await l.remove("activity",`id = ${e}`),await st(l));var Zt=(l,e,a)=>{var r;_(e,""),(r=t(a))==null||r.showModal()},$t=(l,e,a,r,v)=>{var o;e(t(a).name),_(r,""),(o=t(v))==null||o.closeModal()},te=f('<span class="badge bg-success">TASK</span>'),ee=async(l,e,a,r)=>{if(l.stopPropagation(),!e.dbWorker){console.error("dbWorker not ready yet.");return}a(await Xt(e.dbWorker,t(r).id))},ae=f('<li class="option-item svelte-1llkq39"><div class="option-container svelte-1llkq39"><button type="button" class="btn btn-outline-primary option-select-btn svelte-1llkq39"><!> </button> <button type="button" class="delete-btn svelte-1llkq39" aria-label="Delete activity"><i class="bi bi-trash"></i></button></div></li>'),re=f('<ul class="options-list svelte-1llkq39"></ul>'),oe=async(l,e,a,r,v,o)=>{var s;if(!e.dbWorker){console.error("dbWorker not ready yet.");return}a(await Qt(e.dbWorker,t(r))),v(t(r)),_(r,""),(s=t(o))==null||s.closeModal()},se=f('<p> </p> <button type="button" class="btn btn-outline-success w-100"> </button>',1),ne=(l,e,a)=>{var r;_(e,""),(r=t(a))==null||r.closeModal()},ie=f('<input type="text" class="form-control mb-3" placeholder="Name of an activity. Reading, writing, etc."/> <!> <button type="button" class="btn btn-secondary w-100 mt-3">Cancel</button>',1),le=f('<button id="activity select" type="button" class="btn btn-outline-primary w-100"> </button> <!>',1);function ce(l,e){U(e,!0);let a=K(e,"selected",15),r=K(e,"taskAndActivities",15),v=R(null),o=R(""),s=ot(()=>t(o).length===0?r():r().filter(u=>u.name.toLowerCase().includes(t(o).toLowerCase())));var W=le(),m=z(W);m.__click=[Zt,o,v];var O=c(m,!0);n(m);var i=y(m,2);vt(mt(i,{title:"Select an activity",children:(u,E)=>{var P=ie(),C=z(P);X(C);var N=y(C,2);{var x=j=>{var I=re();tt(I,21,()=>t(s),g=>g.name,(g,A)=>{var w=ae(),b=c(w),h=c(b);h.__click=[$t,a,A,o,v];var T=c(h);{var S=L=>{var Y=te();p(L,Y)};H(T,L=>{t(A).isTask&&L(S)})}var d=y(T);n(h);var D=y(h,2);D.__click=[ee,e,r,A],n(b),n(w),F(()=>q(d,` ${t(A).name??""}`)),p(g,w)}),n(I),p(j,I)},M=j=>{var I=se(),g=z(I),A=c(g);n(g);var w=y(g,2);w.__click=[oe,e,r,o,a,v];var b=c(w);n(w),F(()=>{q(A,`No options found for "${t(o)??""}"`),q(b,`Create "${t(o)??""}"`)}),p(j,I)};H(N,j=>{t(s).length>0||t(o)===""?j(x):j(M,!1)})}var V=y(N,2);V.__click=[ne,o,v],Z(C,()=>t(o),j=>_(o,j)),p(u,P)},$$slots:{default:!0}}),u=>_(v,u,!0),()=>t(v)),F(()=>q(O,a())),p(l,W),J()}$(["click"]);var ve=(l,e)=>{Rt(),_(e,B.Running,!0)},ue=f('<button type="button" class="btn btn-outline-success w-100 h-100 d-flex justify-content-center align-items-center">Start</button>'),de=(l,e)=>{Et(),_(e,B.Running,!0)},_e=f('<button type="button" class="btn btn-outline-primary flex-grow-1" style="margin-right: 10px;">Resume</button>'),me=(l,e)=>{qt(),_(e,B.Paused,!0)},pe=f('<button type="button" class="btn btn-outline-warning flex-grow-1" style="margin-right: 10px;">Pause</button>'),be=async(l,e,a,r)=>{if(e.activityName.length===0||e.activityName==="Activity"){console.log(e.activityName),console.error("No activity selected.");return}let[v,o,s]=It();if(!t(a)){console.error("No database worker available.");return}await pt(t(a),e.activityName,e.projectName,s,v,o),_(r,B.Stopped,!0),e.onActivityStopped&&await e.onActivityStopped()},fe=f('<div style="display: flex; justify-content: space-between; margin-top: 10px;"><!> <button type="button" class="btn btn-outline-danger flex-grow-1">Stop</button></div>'),ye=f("<!> <!>",1);function ge(l,e){U(e,!0);let a=R(G(B.Stopped)),r=R(null);dt(async()=>{const i=await ut(()=>import("../chunks/BYbjoqHL.js"),[],import.meta.url);_(r,_t(new i.default),!0),await t(r).initWorker()});var o=ye(),s=z(o);{var W=i=>{var u=ue();u.__click=[ve,a],p(i,u)};H(s,i=>{t(a)===B.Stopped&&i(W)})}var m=y(s,2);{var O=i=>{var u=fe(),E=c(u);{var P=x=>{var M=_e();M.__click=[de,a],p(x,M)},C=x=>{var M=pe();M.__click=[me,a],p(x,M)};H(E,x=>{t(a)===B.Paused?x(P):x(C,!1)})}var N=y(E,2);N.__click=[be,e,r,a],n(u),p(i,u)};H(m,i=>{(t(a)===B.Running||t(a)===B.Paused)&&i(O)})}p(l,o),J()}$(["click"]);var ke=f('<span class="badge rounded-pill"> </span>'),we=f('<li class="svelte-fg8y06"><strong> </strong> <!> <span class="duration svelte-fg8y06"> </span> <span class="ended svelte-fg8y06"> </span></li>'),he=f('<div class="scrollable-list svelte-fg8y06"><ul class="svelte-fg8y06"></ul></div>'),xe=f("<p>No recently tracked activities found.</p>"),je=f("<p>Loading recently tracked activities...</p>"),Ae=f('<div class="recently-done-container svelte-fg8y06"><h3>Recent activities</h3> <!></div>');function Te(l,e){U(e,!0);let a=R(G([]));const r=async()=>{_(a,e.logs.sort((i,u)=>u.end-i.end).slice(0,10),!0)},v=i=>{const u=new Date(i);return u.toLocaleDateString()+" "+u.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})},o=i=>{let{hours:u,minutes:E,seconds:P}=bt(i);const C=[];return u>0&&C.push(`${Math.round(u)}h`),E>0&&C.push(`${Math.round(E)}m`),(P>0||C.length===0)&&C.push(`${Math.round(P)}s`),C.join("")};At(()=>{r()});var s=Ae(),W=y(c(s),2);{var m=i=>{var u=xt(),E=z(u);{var P=N=>{var x=he(),M=c(x);tt(M,21,()=>t(a),V=>V.id,(V,j)=>{var I=we(),g=c(I),A=c(g,!0);n(g);var w=y(g,2);{var b=D=>{var L=ke(),Y=c(L,!0);n(L),F(()=>{Pt(L,`background-color: ${t(j).project_color||"#6c757d"}; color: white; margin-left: 8px;`),q(Y,t(j).project_name)}),p(D,L)};H(w,D=>{t(j).project_name&&D(b)})}var h=y(w,2),T=c(h,!0);n(h);var S=y(h,2),d=c(S,!0);n(S),n(I),F((D,L)=>{q(A,t(j).activity),q(T,D),q(d,L)},[()=>o(t(j).elapsed),()=>v(t(j).end)]),p(V,I)}),n(M),n(x),p(N,x)},C=N=>{var x=xe();p(N,x)};H(E,N=>{t(a).length>0?N(P):N(C,!1)})}p(i,u)},O=i=>{var u=je();p(i,u)};H(W,i=>{e.dbWorker?i(m):i(O,!1)})}n(s),p(l,s),J()}const Se=async(l,e,a)=>{if(t(e)){const r=Date.now(),v=r-2*60*60,o=r,s=o-v;await pt(t(e),"TEST ACTIVITY","No Project",s,r-2*60*60*1e3,o),await a()}};var We=f(" <sup> </sup>",1),Pe=f("<p>Please select or create an activity to track.</p>"),Ce=f('<!> <br/> <form><div class="d-flex gap-2 mb-3"><div class="flex-grow-1"><!></div> <div class="flex-grow-1"><!></div></div> <div class="display-1 fw-bold my-3"></div> <!></form> <div class="mt-3"><button class="btn btn-secondary" type="button">ADD TEST ACTIVITY</button></div> <br/> <!>',1),Ne=f('<div class="d-flex flex-column align-items-center p-5"><div class="spinner-border text-primary" role="status"><span class="visually-hidden">Loading...</span></div> <p class="mt-3 mb-0">Please wait while the app loads</p></div>'),Me=f('<main class="container mt-5"><div class="row justify-content-center"><div class="col-md-8 col-lg-6 text-center"><!></div></div></main>');function Fe(l,e){U(e,!0);const[a,r]=St(),v=()=>Wt(Ot,"$seconds",a);let o=R("Activity"),s=R("No Project"),W=R(""),m=R(null),O=R(G([])),i=R(G([])),u=R(G([])),E=R(G([]));const P=(b,h)=>{const T=b.filter(d=>d.completed==0).map(d=>({id:d.id,name:d.name,isTask:!0})),S=h.map(d=>({id:d.id,name:d.name,isTask:!1}));return[...T,...S]};let C=ot(()=>P(t(O),t(u)));const N=b=>{let{hours:h,minutes:T,seconds:S}=bt(b);const d=[];return h>0&&d.push({value:h,unit:"h"}),T>0&&d.push({value:T,unit:"m"}),(S>0||d.length===0)&&d.push({value:S,unit:"s"}),d},x=async()=>{const b=await ut(()=>import("../chunks/BYbjoqHL.js"),[],import.meta.url);_(m,_t(new b.default),!0),await t(m).initWorker(),_(O,await Ct(t(m)),!0),_(u,await st(t(m)),!0),_(E,await Lt(t(m)),!0),_(i,await ct(t(m)),!0)},M=async()=>{t(m)&&_(i,await ct(t(m)),!0)};dt(x);var V=Me(),j=c(V),I=c(j),g=c(I);{var A=b=>{var h=Ce(),T=z(h);Nt(T,{get dbWorker(){return t(m)},get tasks(){return t(O)},set tasks(k){_(O,k,!0)}});var S=y(T,4),d=c(S),D=c(d),L=c(D);ce(L,{get dbWorker(){return t(m)},get selected(){return t(o)},set selected(k){_(o,k,!0)},get taskAndActivities(){return t(C)},set taskAndActivities(k){_(C,k,!0)}}),n(D);var Y=y(D,2),et=c(Y);Jt(et,{get dbWorker(){return t(m)},get selected(){return t(s)},set selected(k){_(s,k,!0)},get color(){return t(W)},set color(k){_(W,k,!0)},get projects(){return t(E)},set projects(k){_(E,k,!0)}}),n(Y),n(d);var at=y(d,2);tt(at,5,()=>N(v()),k=>k.unit,(k,Q)=>{Tt();var nt=We(),it=z(nt,!0),lt=y(it),ht=c(lt,!0);n(lt),F(()=>{q(it,t(Q).value),q(ht,t(Q).unit)}),p(k,nt)}),n(at);var ft=y(at,2);{var yt=k=>{var Q=Pe();p(k,Q)},gt=k=>{ge(k,{get activityName(){return t(o)},get projectName(){return t(s)},onActivityStopped:M})};H(ft,k=>{t(o)==="Activity"?k(yt):k(gt,!1)})}n(S);var rt=y(S,2),kt=c(rt);kt.__click=[Se,m,M],n(rt);var wt=y(rt,4);Te(wt,{get dbWorker(){return t(m)},get logs(){return t(i)}}),jt("submit",S,k=>k.preventDefault()),p(b,h)},w=b=>{var h=Ne();p(b,h)};H(g,b=>{t(m)?b(A):b(w,!1)})}n(I),n(j),n(V),p(l,V),J(),r()}$(["click"]);export{Fe as component};
