import{p as rt,b as bt,i as O,_ as yt}from"../chunks/B0vD_CDy.js";import{d as _t,f as b,a as f,c as At,g as St}from"../chunks/DYAZ3xSE.js";import{C as it,D as J,F as T,H as u,J as c,I as w,j as t,z as o,aC as dt,A as pt,K as Q,G as st,am as tt,aA as gt,f as mt,aS as Nt}from"../chunks/CovMCToo.js";import{s as I}from"../chunks/Chg3hcGr.js";import{e as ct}from"../chunks/B3QRiNGC.js";import{s as Pt,a as Wt}from"../chunks/GgNxBzVg.js";import{w as kt}from"../chunks/B8fJUUNV.js";import{a as wt,u as Tt,b as Ct,c as Lt,l as Mt}from"../chunks/C-3cOWRw.js";import{r as et,b as Dt}from"../chunks/CxkTVC9Y.js";import{b as at,e as Rt,c as Et,l as It,T as Ut}from"../chunks/BshZFSB1.js";import{M as ht}from"../chunks/Ogyqt5yR.js";import{T as B,s as qt,a as Ht,b as Kt,r as Ot,p as Vt,c as xt,l as ft,d as zt}from"../chunks/KS9X02YG.js";var Ft=(n,e,a)=>{var r;o(e,""),(r=t(a))==null||r.showModal()},Gt=(n,e,a,r)=>{o(e,t(a).name,!0),o(r,t(a).name,!0)},Jt=async(n,e,a,r,s)=>{n.key==="Escape"?(o(e,null),o(a,"")):n.key==="Enter"&&await r(t(s))},Bt=async(n,e,a)=>await e(t(a)),Qt=b('<div class="d-flex w-100"><input type="text" class="form-control edit-input flex-grow-1 svelte-ckgnd6"/> <button aria-label="Confirm changes to project name" type="button" class="btn btn-success btn-sm ms-1 svelte-ckgnd6" title="Confirm changes">✓</button></div>'),Xt=(n,e,a,r,s,d,l)=>{var g;o(e,t(a).name,!0),r(t(e)),o(s,t(a).color,!0),d(t(s)),(g=t(l))==null||g.closeModal()},Yt=b('<button type="button" class="btn btn-outline-primary flex-grow-1 d-flex p-0 svelte-ckgnd6" style="border-top-left-radius: 0; border-bottom-left-radius: 0;"><span class="project-name svelte-ckgnd6"> </span></button>'),Zt=async(n,e,a,r)=>{e(await Ct(a.dbWorker,t(r).name,t(r).color))},$t=b('<li class="option-item svelte-ckgnd6"><div class="d-flex"><button aria-label="Edit project name" type="button" class="btn btn-outline-secondary svelte-ckgnd6" title="Edit project name"><i class="bi bi-pencil"></i></button> <!> <input type="color" class="form-control form-control-color svelte-ckgnd6" title="Update project color"/></div></li>'),te=b('<ul class="options-list svelte-ckgnd6"></ul>'),ee=async(n,e,a,r,s,d,l,g)=>{var _;if(!e.dbWorker){console.error("dbWorker not ready yet.");return}a(await Lt(e.dbWorker,t(r),t(s))),d(t(r)),l(t(s)),(_=t(g))==null||_.closeModal()},ae=b('<p> </p> <div class="new-project-section svelte-ckgnd6"><div class="color-picker-container svelte-ckgnd6"><input type="color" id="project-color" title="Choose project color" class="svelte-ckgnd6"/></div> <button type="button" class="btn btn-outline-success w-100 mt-2"> </button></div>',1),re=b('<input type="text" class="form-control mb-3" placeholder="Type name of project. Relaxing, work, etc."/> <!> <button type="button" class="btn btn-secondary w-100 mt-3">Cancel</button>',1),oe=b('<button id="activity select" type="button" class="btn btn-outline-primary w-100"> </button> <!>',1);function ne(n,e){it(e,!0);let a=rt(e,"selected",15),r=rt(e,"color",15),s=rt(e,"projects",15),d=T(null),l=T(""),g=T("#3498db"),_=T(null),p=T(""),v=dt(()=>t(l).length===0?s():s().filter(h=>h.name.toLowerCase().includes(t(l).toLowerCase())));function m(h){return h.focus(),{destroy(){}}}const M=async h=>{t(p).trim()&&t(p)!==h.name&&(s(await Tt(e.dbWorker,h.name,t(p).trim())),a()===h.name&&a(t(p).trim()),await e.onProjectUpdated()),o(_,null),o(p,"")};var U=oe(),C=J(U);C.__click=[Ft,l,d];var D=u(C,!0);c(C);var L=w(C,2);bt(ht(L,{title:"Select a project",children:(h,A)=>{var q=re(),V=J(q);et(V);var z=w(V,2);{var X=N=>{var k=te();ct(k,21,()=>t(v),y=>y.name,(y,x,P)=>{var j=$t(),E=u(j),K=u(E);K.__click=[Gt,_,x,p];var Y=w(K,2);{var $=i=>{var S=Qt(),R=u(S);et(R),R.__keydown=[Jt,_,p,M,x],pt(()=>at(R,()=>t(p),Z=>o(p,Z))),wt(R,Z=>m==null?void 0:m(Z));var G=w(R,2);G.__click=[Bt,M,x],c(S),f(i,S)},ot=i=>{var S=Yt();S.__click=[Xt,l,x,a,g,r,d];var R=u(S),G=u(R,!0);c(R),c(S),Q(()=>I(G,t(x).name)),f(i,S)};O(Y,i=>{t(_)===t(x).name?i($):i(ot,!1)})}var F=w(Y,2);et(F),F.__change=[Zt,s,e,x],c(E),c(j),at(F,()=>t(x).color,i=>t(x).color=i),f(y,j)}),c(k),f(N,k)},W=N=>{var k=ae(),y=J(k),x=u(y);c(y);var P=w(y,2),j=u(P),E=u(j);et(E),c(j);var K=w(j,2);K.__click=[ee,e,s,l,g,a,r,d];var Y=u(K);c(K),c(P),Q(()=>{I(x,`No options found for "${t(l)??""}"`),I(Y,`Create "${t(l)??""}"`)}),at(E,()=>t(g),$=>o(g,$)),f(N,k)};O(z,N=>{t(v).length>0||t(l)===""?N(X):N(W,!1)})}var H=w(z,2);H.__click=function(...N){var k,y;(y=(k=t(d))==null?void 0:k.closeModal)==null||y.apply(this,N)},at(V,()=>t(l),N=>o(l,N)),f(h,q)},$$slots:{default:!0}}),h=>o(d,h,!0),()=>t(d)),Q(()=>I(D,t(l)||"No Project")),f(n,U),st()}_t(["click","keydown","change"]);const nt=async n=>{var a;const e=await n.list("activity");return console.log("Received activities from worker.",e),((a=e==null?void 0:e.result)==null?void 0:a.resultRows)||[]},ie=async(n,e)=>(await n.insert("activity","name",`'${e}'`),await nt(n)),se=async(n,e)=>(await n.remove("activity",`id = ${e}`),await nt(n)),le=async(n,e,a)=>(await n.update("activity",`name = '${a}'`,`name = '${e}'`),await nt(n)),ce=(n,e)=>{const a=n.filter(s=>s.completed==0).map(s=>({id:s.id,name:s.name,isTask:!0})),r=e.map(s=>({id:s.id,name:s.name,isTask:!1}));return[...a,...r]};var ve=(n,e,a)=>{var r;o(e,""),(r=t(a))==null||r.showModal()},ue=(n,e,a,r)=>{o(e,t(a).name,!0),o(r,t(a).name,!0)},de=async(n,e,a,r,s)=>{n.key==="Escape"?(o(e,null),o(a,"")):n.key==="Enter"&&await r(t(s))},_e=async(n,e,a)=>{await e(t(a))},me=b('<div class="d-flex w-100"><input type="text" class="form-control edit-input flex-grow-1"/> <button aria-label="Confirm changes to activity name" type="button" class="btn btn-success btn-sm ms-1" title="Confirm changes">✓</button></div>'),fe=(n,e,a,r,s)=>{var d;e(t(a).name),o(r,""),(d=t(s))==null||d.closeModal()},be=b('<span class="badge bg-success">TASK</span>'),ye=async(n,e,a)=>{n.stopPropagation(),await e(t(a))},pe=b('<button type="button" class="btn btn-outline-primary option-select-btn svelte-1llkq39"><!> </button> <button type="button" class="delete-btn svelte-1llkq39" aria-label="Delete activity"><i class="bi bi-trash"></i></button>',1),ge=b('<li class="option-item svelte-1llkq39"><div class="d-flex"><button aria-label="Edit activity name" type="button" class="btn btn-outline-secondary" title="Edit activity name"><i class="bi bi-pencil"></i></button> <!></div></li>'),ke=b('<ul class="options-list svelte-1llkq39"></ul>'),we=async(n,e,a,r,s,d)=>{var l;if(!e.dbWorker){console.error("dbWorker not ready yet.");return}a(await ie(e.dbWorker,t(r))),s(t(r)),o(r,""),(l=t(d))==null||l.closeModal()},he=b('<p> </p> <button type="button" class="btn btn-outline-success w-100"> </button>',1),xe=(n,e,a)=>{var r;o(e,""),(r=t(a))==null||r.closeModal()},je=b('<input type="text" class="form-control mb-3" placeholder="Name of an activity. Reading, writing, etc."/> <!> <button type="button" class="btn btn-secondary w-100 mt-3">Cancel</button>',1),Ae=b('<button id="activity select" type="button" class="btn btn-outline-primary w-100"> </button> <!>',1);function Se(n,e){it(e,!0);let a=rt(e,"selected",15),r=rt(e,"tasks",15),s=rt(e,"activities",15),d=dt(()=>ce(r(),s())),l=T(null),g=T(""),_=T(null),p=T(""),v=dt(()=>t(g).length===0?t(d):t(d).filter(A=>A.name.toLowerCase().includes(t(g).toLowerCase())));function m(A){return A.focus(),{destroy(){}}}const M=async A=>{t(p).trim()&&t(p)!==A.name&&(A.isTask?r(await Rt(e.dbWorker,A.id,t(p))):await le(e.dbWorker,A.name,t(p)),await e.refreshActivities()),o(_,null),o(p,"")},U=async A=>{if(!e.dbWorker){console.error("dbWorker not ready yet.");return}A.isTask?r(await Et(e.dbWorker,A.id)):s(await se(e.dbWorker,A.id))};var C=Ae(),D=J(C);D.__click=[ve,g,l];var L=u(D,!0);c(D);var h=w(D,2);bt(ht(h,{title:"Select an activity",children:(A,q)=>{var V=je(),z=J(V);et(z);var X=w(z,2);{var W=k=>{var y=ke();ct(y,21,()=>t(v),x=>x.name,(x,P)=>{var j=ge(),E=u(j),K=u(E);K.__click=[ue,_,P,p];var Y=w(K,2);{var $=F=>{var i=me(),S=u(i);et(S),S.__keydown=[de,_,p,M,P],pt(()=>at(S,()=>t(p),G=>o(p,G))),wt(S,G=>m==null?void 0:m(G));var R=w(S,2);R.__click=[_e,M,P],c(i),f(F,i)},ot=F=>{var i=pe(),S=J(i);S.__click=[fe,a,P,g,l];var R=u(S);{var G=ut=>{var jt=be();f(ut,jt)};O(R,ut=>{t(P).isTask&&ut(G)})}var Z=w(R);c(S);var vt=w(S,2);vt.__click=[ye,U,P],Q(()=>I(Z,` ${t(P).name??""}`)),f(F,i)};O(Y,F=>{t(_)===t(P).name?F($):F(ot,!1)})}c(E),c(j),f(x,j)}),c(y),f(k,y)},H=k=>{var y=he(),x=J(y),P=u(x);c(x);var j=w(x,2);j.__click=[we,e,s,g,a,l];var E=u(j);c(j),Q(()=>{I(P,`No options found for "${t(g)??""}"`),I(E,`Create "${t(g)??""}"`)}),f(k,y)};O(X,k=>{t(v).length>0||t(g)===""?k(W):k(H,!1)})}var N=w(X,2);N.__click=[xe,g,l],at(z,()=>t(g),k=>o(g,k)),f(A,V)},$$slots:{default:!0}}),A=>o(l,A,!0),()=>t(l)),Q(()=>I(L,a())),f(n,C),st()}_t(["click","keydown"]);const lt=()=>typeof window<"u";var Ne=(n,e)=>{qt(),o(e,B.Running,!0)},Pe=b('<button type="button" class="btn btn-outline-success w-100 h-100 d-flex justify-content-center align-items-center">Start</button>'),We=(n,e)=>{Ot(),o(e,B.Running,!0)},Te=b('<button type="button" class="btn btn-outline-primary flex-grow-1" style="margin-right: 10px;">Resume</button>'),Ce=(n,e)=>{Vt(),o(e,B.Paused,!0)},Le=b('<button type="button" class="btn btn-outline-warning flex-grow-1" style="margin-right: 10px;">Pause</button>'),Me=async(n,e,a,r)=>{if(e.activityName.length===0||e.activityName==="Activity"){console.log(e.activityName),console.error("No activity selected.");return}let[s,d,l]=Ht();if(!t(a)){console.error("No database worker available.");return}await Kt(t(a),e.activityName,e.projectName,l,s,d),o(r,B.Stopped,!0),e.onActivityStopped&&await e.onActivityStopped()},De=b('<div style="display: flex; justify-content: space-between; margin-top: 10px;"><!> <button type="button" class="btn btn-outline-danger flex-grow-1">Stop</button></div>'),Re=b("<!> <!>",1);function Ee(n,e){it(e,!0);let a=T(tt(B.Stopped));if(lt()){let v=localStorage.getItem("timerState");v&&o(a,v,!0)}let r=T(null);gt(async()=>{const v=await yt(()=>import("../chunks/BYbjoqHL.js"),[],import.meta.url);o(r,kt(new v.default),!0),await t(r).initWorker()}),mt(()=>{lt()&&localStorage.setItem("timerState",t(a))});var d=Re(),l=J(d);{var g=v=>{var m=Pe();m.__click=[Ne,a],f(v,m)};O(l,v=>{t(a)===B.Stopped&&v(g)})}var _=w(l,2);{var p=v=>{var m=De(),M=u(m);{var U=L=>{var h=Te();h.__click=[We,a],f(L,h)},C=L=>{var h=Le();h.__click=[Ce,a],f(L,h)};O(M,L=>{t(a)===B.Paused?L(U):L(C,!1)})}var D=w(M,2);D.__click=[Me,e,r,a],c(m),f(v,m)};O(_,v=>{(t(a)===B.Running||t(a)===B.Paused)&&v(p)})}f(n,d),st()}_t(["click"]);var Ie=b('<span class="badge rounded-pill"> </span>'),Ue=b('<li class="svelte-fg8y06"><strong> </strong> <!> <span class="duration svelte-fg8y06"> </span> <span class="ended svelte-fg8y06"> </span></li>'),qe=b('<div class="scrollable-list svelte-fg8y06"><ul class="svelte-fg8y06"></ul></div>'),He=b("<p>No recently tracked activities found.</p>"),Ke=b("<p>Loading recently tracked activities...</p>"),Oe=b('<div class="recently-done-container svelte-fg8y06"><h3>Recent activities</h3> <!></div>');function Ve(n,e){it(e,!0);let a=T(tt([]));const r=async()=>{o(a,e.logs.sort((v,m)=>m.end-v.end).slice(0,10),!0)},s=v=>{const m=new Date(v);return m.toLocaleDateString()+" "+m.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})},d=v=>{let{hours:m,minutes:M,seconds:U}=xt(v);const C=[];return m>0&&C.push(`${Math.round(m)}h`),M>0&&C.push(`${Math.round(M)}m`),(U>0||C.length===0)&&C.push(`${Math.round(U)}s`),C.join("")};mt(()=>{r()});var l=Oe(),g=w(u(l),2);{var _=v=>{var m=At(),M=J(m);{var U=D=>{var L=qe(),h=u(L);ct(h,21,()=>t(a),A=>A.id,(A,q)=>{var V=Ue(),z=u(V),X=u(z,!0);c(z);var W=w(z,2);{var H=P=>{var j=Ie(),E=u(j,!0);c(j),Q(()=>{Dt(j,`background-color: ${t(q).project_color||"#6c757d"}; color: white; margin-left: 8px;`),I(E,t(q).project_name)}),f(P,j)};O(W,P=>{t(q).project_name&&P(H)})}var N=w(W,2),k=u(N,!0);c(N);var y=w(N,2),x=u(y,!0);c(y),c(V),Q((P,j)=>{I(X,t(q).activity),I(k,P),I(x,j)},[()=>d(t(q).elapsed),()=>s(t(q).end)]),f(A,V)}),c(h),c(L),f(D,L)},C=D=>{var L=He();f(D,L)};O(M,D=>{t(a).length>0?D(U):D(C,!1)})}f(v,m)},p=v=>{var m=Ke();f(v,m)};O(g,v=>{e.dbWorker?v(_):v(p,!1)})}c(l),f(n,l),st()}var ze=b(" <sup> </sup>",1),Fe=b("<p>Please select or create an activity to track.</p>"),Ge=b('<!> <br/> <form><div class="d-flex gap-2 mb-3"><div class="flex-grow-1"><!></div> <div class="flex-grow-1"><!></div></div> <div class="display-1 fw-bold my-3"></div> <!></form> <br/> <!>',1),Je=b('<div class="d-flex flex-column align-items-center p-5"><div class="spinner-border text-primary" role="status"><span class="visually-hidden">Loading...</span></div> <p class="mt-3 mb-0">Please wait while the app loads</p></div>'),Be=b('<main class="container mt-5"><div class="row justify-content-center"><div class="col-md-8 col-lg-6 text-center"><!></div></div></main>');function sa(n,e){it(e,!0);const[a,r]=Pt(),s=()=>Wt(zt,"$seconds",a);let d=T("Activity");if(lt()){let W=localStorage.getItem("currentActivity");W&&o(d,W,!0)}let l=T("No Project"),g=T(""),_=T(null),p=T(tt([])),v=T(tt([])),m=T(tt([])),M=T(tt([]));const U=W=>{let{hours:H,minutes:N,seconds:k}=xt(W);const y=[];return H>0&&y.push({value:H,unit:"h"}),N>0&&y.push({value:N,unit:"m"}),(k>0||y.length===0)&&y.push({value:k,unit:"s"}),y},C=async()=>{const W=await yt(()=>import("../chunks/BYbjoqHL.js"),[],import.meta.url);o(_,kt(new W.default),!0),await t(_).initWorker(),o(p,await It(t(_)),!0),o(m,await nt(t(_)),!0),o(M,await Mt(t(_)),!0),o(v,await ft(t(_)),!0)},D=async()=>{t(_)&&o(m,await nt(t(_)),!0)},L=async()=>{t(_)&&o(v,await ft(t(_)),!0)};gt(C),mt(()=>{lt()&&localStorage.setItem("currentActivity",t(d))});var h=Be(),A=u(h),q=u(A),V=u(q);{var z=W=>{var H=Ge(),N=J(H);Ut(N,{get dbWorker(){return t(_)},get tasks(){return t(p)},set tasks(i){o(p,i,!0)}});var k=w(N,4),y=u(k),x=u(y),P=u(x);Se(P,{get dbWorker(){return t(_)},refreshActivities:D,get tasks(){return t(p)},set tasks(i){o(p,i,!0)},get activities(){return t(m)},set activities(i){o(m,i,!0)},get selected(){return t(d)},set selected(i){o(d,i,!0)}}),c(x);var j=w(x,2),E=u(j);ne(E,{get dbWorker(){return t(_)},onProjectUpdated:L,get selected(){return t(l)},set selected(i){o(l,i,!0)},get color(){return t(g)},set color(i){o(g,i,!0)},get projects(){return t(M)},set projects(i){o(M,i,!0)}}),c(j),c(y);var K=w(y,2);ct(K,5,()=>U(s()),i=>i.unit,(i,S)=>{Nt();var R=ze(),G=J(R,!0),Z=w(G),vt=u(Z,!0);c(Z),Q(()=>{I(G,t(S).value),I(vt,t(S).unit)}),f(i,R)}),c(K);var Y=w(K,2);{var $=i=>{var S=Fe();f(i,S)},ot=i=>{Ee(i,{get activityName(){return t(d)},get projectName(){return t(l)},onActivityStopped:L})};O(Y,i=>{t(d)==="Activity"?i($):i(ot,!1)})}c(k);var F=w(k,4);Ve(F,{get dbWorker(){return t(_)},get logs(){return t(v)}}),St("submit",k,i=>i.preventDefault()),f(W,H)},X=W=>{var H=Je();f(W,H)};O(V,W=>{t(_)?W(z):W(X,!1)})}c(q),c(A),c(h),f(n,h),st(),r()}export{sa as component};
